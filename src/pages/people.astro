---
import BaseLayout from '../layouts/BaseLayout.astro';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
import { getCollection } from 'astro:content';

const peopleEntries = await getCollection('people');
const sortedPeople = [...peopleEntries].sort((a, b) => a.data.order - b.data.order);

type GroupedPeople = {
  pi: typeof sortedPeople;
  master: typeof sortedPeople;
  undergradProspective: typeof sortedPeople;
  researchIntern: typeof sortedPeople;
  alumni: typeof sortedPeople;
};

const grouped = sortedPeople.reduce<GroupedPeople>(
  (acc, person) => {
    switch (person.data.group) {
      case 'pi':
        acc.pi.push(person);
        break;
      case 'master':
        acc.master.push(person);
        break;
      case 'undergrad-prospective':
        acc.undergradProspective.push(person);
        break;
      case 'research-intern':
        acc.researchIntern.push(person);
        break;
      case 'alumni':
        acc.alumni.push(person);
        break;
    }

    return acc;
  },
  {
    pi: [],
    master: [],
    undergradProspective: [],
    researchIntern: [],
    alumni: [],
  }
);

const iconSvg: Record<string, string> = {
  github: `<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"/>
  </svg>`,
  scholar: `<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    <path d="M22 10v6M2 10l10-5 10 5-10 5z"/>
    <path d="M6 12v5c3 3 9 3 12 0v-5"/>
  </svg>`,
  homepage: `<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
    <polyline points="9 22 9 12 15 12 15 22"/>
  </svg>`,
};

---

<BaseLayout title="People">
  <Header slot="header" />
  
  <div class="page-header">
    <div class="page-header-content">
      <h1>People</h1>
      <p class="page-subtitle">Meet our research team</p>
    </div>
  </div>

  <!-- Professor Section -->
  <section class="section professor-section">
    <div class="container">
      <h2 class="section-title">Principal Investigator</h2>
      {grouped.pi.length ? (
        grouped.pi.map((person) => (
          <div class="professor-card">
            <div class="professor-image">
              {person.data.profileImage ? (
                <img src={person.data.profileImage} alt={person.data.name} loading="eager" />
              ) : (
                <div class="profile-placeholder">{person.data.name.charAt(0)}</div>
              )}
            </div>
            <div class="professor-info">
              <div class="professor-name-row">
                <h3>{person.data.name}</h3>
                {person.data.links.length > 0 && (
                  <div class="professor-badges">
                    {person.data.links.map((link) => (
                      <a href={link.url} target="_blank" rel="noopener noreferrer" class="prof-badge" title={link.label}>
                        <span class="link-icon" aria-hidden="true" set:html={iconSvg[link.icon] ?? iconSvg.homepage}></span>
                      </a>
                    ))}
                  </div>
                )}
              </div>
              {person.data.position && <p class="title">{person.data.position}</p>}
              {person.data.email && (
                <p class="email clickable-email" data-email={person.data.email}>
                  Email: {person.data.email}
                </p>
              )}
              <div class="bio">
                {person.data.researchAreas.length > 0 && (
                  <>
                    <h4>Research Interests</h4>
                    <ul>
                      {person.data.researchAreas.map((area) => (
                        <li>{area}</li>
                      ))}
                    </ul>
                  </>
                )}
                {person.data.education.length > 0 && (
                  <>
                    <h4>Education</h4>
                    <ul>
                      {person.data.education.map((item) => (
                        <li>{item}</li>
                      ))}
                    </ul>
                  </>
                )}
              </div>
            </div>
          </div>
        ))
      ) : (
        <p class="section-empty">Principal investigator information will be updated soon.</p>
      )}
    </div>
  </section>

  <!-- Graduate Students Section -->
  <section class="section students-section">
    <div class="container">
      <h2 class="section-title">Master Students</h2>
      {grouped.master.length ? (
        <div class="students-grid">
          {grouped.master.map((person) => (
            <div class="student-card">
              <div class="student-image">
                {person.data.profileImage ? (
                  <img src={person.data.profileImage} alt={person.data.name} loading="lazy" />
                ) : (
                  <div class="profile-placeholder profile-placeholder--small">
                    {person.data.name.charAt(0)}
                  </div>
                )}
              </div>
              <div class="student-info">
                <h3>
                  {person.data.name}
                  {person.data.note && <span class="student-note">({person.data.note})</span>}
                </h3>
                {person.data.email && (
                  <p class="student-email clickable-email" data-email={person.data.email}>
                    {person.data.email}
                  </p>
                )}
                {person.data.researchAreas.length > 0 && (
                  <p class="student-research-area">
                    Research: {person.data.researchAreas.join(', ')}
                  </p>
                )}
                {person.data.links.length > 0 && (
                  <div class="student-links">
                    {person.data.links.map((link) => (
                      <a href={link.url} target="_blank" rel="noopener noreferrer" class="student-badge" title={link.label}>
                        <span class="link-icon" aria-hidden="true" set:html={iconSvg[link.icon] ?? iconSvg.homepage}></span>
                      </a>
                    ))}
                  </div>
                )}
              </div>
            </div>
          ))}
        </div>
      ) : (
        <p class="section-empty">Master student profiles will be updated soon.</p>
      )}
    </div>
  </section>

  <!-- Undergraduate Students Section -->
  <section class="section students-section">
    <div class="container">
      <h2 class="section-title">Undergraduate Research Interns</h2>
      {grouped.undergradProspective.length > 0 && (
        <>
          <p class="section-subtitle-secondary">Prospective Master Students</p>
          <div class="students-grid">
            {grouped.undergradProspective.map((person) => (
              <div class="student-card">
                <div class="student-image">
                  {person.data.profileImage ? (
                    <img src={person.data.profileImage} alt={person.data.name} loading="lazy" />
                  ) : (
                    <div class="profile-placeholder profile-placeholder--small">
                      {person.data.name.charAt(0)}
                    </div>
                  )}
                </div>
                <div class="student-info">
                  <h3>{person.data.name}</h3>
                  {person.data.email && (
                    <p class="student-email clickable-email" data-email={person.data.email}>
                      {person.data.email}
                    </p>
                  )}
                  {person.data.researchAreas.length > 0 && (
                    <p class="student-research-area">
                      Research: {person.data.researchAreas.join(', ')}
                    </p>
                  )}
                  {person.data.links.length > 0 && (
                    <div class="student-links">
                      {person.data.links.map((link) => (
                        <a href={link.url} target="_blank" rel="noopener noreferrer" class="student-badge" title={link.label}>
                          <span class="link-icon" aria-hidden="true" set:html={iconSvg[link.icon] ?? iconSvg.homepage}></span>
                        </a>
                      ))}
                    </div>
                  )}
                </div>
              </div>
            ))}
          </div>
        </>
      )}

      {grouped.researchIntern.length > 0 && (
        <>
          <p class="section-subtitle-secondary research-interns-label">Research Interns</p>
          <div class="students-grid">
            {grouped.researchIntern.map((person) => (
              <div class="student-card">
                <div class="student-image">
                  {person.data.profileImage ? (
                    <img src={person.data.profileImage} alt={person.data.name} loading="lazy" />
                  ) : (
                    <div class="profile-placeholder profile-placeholder--small">
                      {person.data.name.charAt(0)}
                    </div>
                  )}
                </div>
                <div class="student-info">
                  <h3>{person.data.name}</h3>
                  {person.data.email && (
                    <p class="student-email clickable-email" data-email={person.data.email}>
                      {person.data.email}
                    </p>
                  )}
                  {person.data.researchAreas.length > 0 && (
                    <p class="student-research-area">
                      Research: {person.data.researchAreas.join(', ')}
                    </p>
                  )}
                  {person.data.links.length > 0 && (
                    <div class="student-links">
                      {person.data.links.map((link) => (
                        <a href={link.url} target="_blank" rel="noopener noreferrer" class="student-badge" title={link.label}>
                          <span class="link-icon" aria-hidden="true" set:html={iconSvg[link.icon] ?? iconSvg.homepage}></span>
                        </a>
                      ))}
                    </div>
                  )}
                </div>
              </div>
            ))}
          </div>
        </>
      )}

      {!grouped.undergradProspective.length && !grouped.researchIntern.length && (
        <p class="section-empty">Undergraduate and research intern profiles will be updated soon.</p>
      )}
    </div>
  </section>

  <!-- Alumni Section -->
  <section class="section alumni-section">
    <div class="container">
      <h2 class="section-title">Alumni</h2>
      {grouped.alumni.length ? (
        <ul class="alumni-list">
          {grouped.alumni.map((person) => (
            <li class="alumni-item">
              <span class="alumni-name">{person.data.name}</span>
              {person.data.note && <span class="alumni-note">{person.data.note}</span>}
            </li>
          ))}
        </ul>
      ) : (
        <p class="alumni-placeholder">It will be updated later...</p>
      )}
    </div>
  </section>

  <Footer slot="footer" />
</BaseLayout>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const emailElements = document.querySelectorAll('.clickable-email');
    
    emailElements.forEach(element => {
      element.addEventListener('click', async () => {
        const email = element.getAttribute('data-email');
        
        if (!email) return;
        
        try {
          await navigator.clipboard.writeText(email);
          
          // Visual feedback
          const originalText = element.textContent;
          element.classList.add('email-copied');
          element.textContent = 'Copied!';
          
          setTimeout(() => {
            element.classList.remove('email-copied');
            element.textContent = originalText;
          }, 1500);
        } catch (err) {
          console.error('Failed to copy email:', err);
        }
      });
    });
  });
</script>

<style>
  .page-header {
    min-height: 30vh;
    background-image: url('/ewha.gif');
    background-size: cover;
    background-position: center;
    background-attachment: fixed;
    display: flex;
    align-items: flex-end;
    justify-content: center;
    color: white;
    position: relative;
    padding: 2.5rem 0;
  }

  .page-header::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-image: 
      repeating-linear-gradient(
        0deg,
        rgba(255, 255, 255, 0.08) 0px,
        transparent 1px,
        transparent 40px,
        rgba(255, 255, 255, 0.08) 41px
      ),
      repeating-linear-gradient(
        90deg,
        rgba(255, 255, 255, 0.08) 0px,
        transparent 1px,
        transparent 40px,
        rgba(255, 255, 255, 0.08) 41px
      );
    pointer-events: none;
    z-index: 1;
  }

  .page-header-content {
    position: relative;
    z-index: 2;
    width: 100%;
    max-width: 1000px;
    padding: 0 60px;
    text-align: left;
  }

  .page-header h1 {
    font-size: 2.5rem;
    font-weight: 700;
    margin-bottom: 0.15rem;
    text-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
  }

  .page-subtitle {
    font-size: 0.9rem;
    font-weight: 300;
    opacity: 0.95;
    text-shadow: 0 1px 4px rgba(0, 0, 0, 0.15);
    margin: 0;
  }

  .section {
    padding: 2rem 0;
  }

  .section-title {
    text-align: left;
   font-size: 2rem;
   margin-bottom: 1.3rem;
   color: #1a2a20;
   font-weight: 700;
  }

  .section-empty {
    color: #666;
    font-size: 0.9rem;
    font-weight: 300;
  }

  .professor-section {
    background: #f8f9fa;
    position: relative;
    overflow: hidden;
  }

  .professor-section::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-image: 
      repeating-linear-gradient(
        0deg,
        rgba(0, 70, 42, 0.03) 0px,
        transparent 1px,
        transparent 40px,
        rgba(0, 70, 42, 0.03) 41px
      ),
      repeating-linear-gradient(
        90deg,
        rgba(0, 70, 42, 0.03) 0px,
        transparent 1px,
        transparent 40px,
        rgba(0, 70, 42, 0.03) 41px
      );
    pointer-events: none;
    z-index: 0;
  }

  .professor-section .container {
    position: relative;
    z-index: 1;
  }

  .professor-card {
    display: grid;
    grid-template-columns: 300px 1fr;
    gap: 3rem;
    background: white;
    padding: 3rem;
    border-radius: 12px;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
    max-width: 1000px;
    margin: 0 auto;
  }

  .professor-image {
    width: 100%;
    aspect-ratio: 3/4;
    background: #e0e0e0;
    border-radius: 8px;
    overflow: hidden;
  }

  .professor-image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .profile-placeholder {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 100%;
    height: 100%;
    background: #d8e2dc;
    color: #00462A;
    font-size: 2.5rem;
    font-weight: 600;
    border-radius: inherit;
  }

  .profile-placeholder--small {
    font-size: 2rem;
  }

  .professor-name-row {
    display: flex;
    align-items: center;
    gap: 1rem;
    flex-wrap: wrap;
    margin-bottom: 0.5rem;
  }

  .professor-info h3 {
    font-size: 2rem;
    color: #1a2a20;
    margin: 0;
  }

  .professor-badges {
    display: flex;
    gap: 0.5rem;
    align-items: center;
  }

  .prof-badge {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 32px;
    height: 32px;
    background: rgba(0, 70, 42, 0.08);
    border-radius: 50%;
    color: #00462A;
    text-decoration: none;
    transition: all 0.3s;
    border: 1px solid rgba(0, 70, 42, 0.15);
  }

  .prof-badge:hover {
    background: rgba(0, 70, 42, 0.15);
    transform: translateY(-2px) scale(1.1);
  }

  .prof-badge svg {
    stroke-width: 2;
    display: block;
    margin: auto;
  }

  .link-icon {
    display: flex;
    align-items: center;
    justify-content: center;
    line-height: 0;
  }

  .link-icon svg {
    display: block;
  }

  .professor-info .title {
    color: #00462A;
    font-size: 1.1rem;
    margin-bottom: 0.5rem;
  }

  .professor-info .email {
    color: #555;
    margin-bottom: 2rem;
  }

  .bio h4 {
    color: #1a2a20;
    margin-top: 1.5rem;
    margin-bottom: 0.75rem;
  }

  .bio ul {
    list-style-position: inside;
    color: #555;
    line-height: 1.8;
  }

  .students-grid {
    display: flex;
    flex-direction: column;
    gap: 1rem;
  }

  .student-card {
    display: flex;
    align-items: center;
    gap: 2rem;
    background: white;
    padding: 0.5em;
    text-align: left;
    transition: all 0.3s ease;
  }

  .student-card:hover {
    background: rgba(0, 70, 42, 0.02);
  }

  .student-image {
    width: 150px;
    height: 150px;
    flex-shrink: 0;
    border-radius: 8px;
    background: #e0e0e0;
    overflow: hidden;
  }

  .student-image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: block;
    transition: transform 0.3s ease;
  }

  .student-card:hover .student-image img {
    transform: scale(1.05);
  }

  .student-info {
    display: flex;
    flex-direction: column;
    gap: 0.4rem;
    flex: 1;
  }

  .student-card h3 {
    color: #1a2a20;
    font-size: 1.1rem;
    font-weight: 600;
    margin: 0 0 0.25rem 0;
  }

  .student-year {
    color: #00462A;
    font-weight: 400;
    font-size: 0.8rem;
    margin: 0;
  }

  .student-note {
    color: #666;
    font-size: 0.7rem;
    font-style: italic;
    margin-left: 0.3rem;
    font-weight: 400;
  }

  .student-email {
    color: #555;
    font-size: 0.8rem;
    margin: 0;
  }

  .clickable-email {
    cursor: pointer;
    transition: color 0.2s;
  }

  .clickable-email:hover {
    color: #00462A;
    text-decoration: underline;
  }

  .email-copied {
    color: #00462A !important;
  }

  .student-research-area {
    color: #666;
    font-size: 0.8rem;
    margin: 0;
  }

  .student-links {
    display: flex;
    gap: 0.5rem;
    margin-top: 0.25rem;
  }

  .student-badge {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 28px;
    height: 28px;
    background: rgba(0, 70, 42, 0.08);
    border-radius: 50%;
    color: #00462A;
    text-decoration: none;
    transition: all 0.3s;
    border: 1px solid rgba(0, 70, 42, 0.15);
  }

  .student-badge:hover {
    background: rgba(0, 70, 42, 0.15);
    transform: scale(1.1);
  }

  .student-badge svg {
    stroke-width: 2;
    display: block;
    margin: auto;
  }

  .section-subtitle-secondary {
    font-size: 0.9rem;
    font-weight: 500;
    color: #00462A;
    margin-bottom: 1rem;
    text-align: left;
  }

  .research-interns-label {
    margin-top: 2rem;
  }

  .alumni-section {
    background: #f8f9fa;
    position: relative;
    overflow: hidden;
  }

  .alumni-section::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-image: 
      repeating-linear-gradient(
        0deg,
        rgba(0, 70, 42, 0.03) 0px,
        transparent 1px,
        transparent 40px,
        rgba(0, 70, 42, 0.03) 41px
      ),
      repeating-linear-gradient(
        90deg,
        rgba(0, 70, 42, 0.03) 0px,
        transparent 1px,
        transparent 40px,
        rgba(0, 70, 42, 0.03) 41px
      );
    pointer-events: none;
    z-index: 0;
  }

  .alumni-section .container {
    position: relative;
    z-index: 1;
  }

  .alumni-list {
    list-style: none;
    padding: 0;
    margin: 0;
    display: grid;
    gap: 0.75rem;
  }

  .alumni-item {
    display: flex;
    gap: 0.5rem;
    font-size: 0.95rem;
    color: #444;
  }

  .alumni-name {
    font-weight: 600;
    color: #1a2a20;
  }

  .alumni-note {
    font-size: 0.8rem;
    color: #666;
    font-style: italic;
  }

  .alumni-placeholder {
    text-align: center;
    color: #777;
    font-size: 1.1rem;
    padding: 3rem 0;
  }

  @media (max-width: 768px) {
    .page-header {
      background-attachment: scroll;
      background-position: center 20%;
      background-size: auto;
    }

    .page-header-content {
      padding: 0 20px;
    }

    .page-header h1 {
      font-size: 2rem;
    }

    .page-header p {
      font-size: 1rem;
    }

    .section {
      padding: 3rem 0;
    }

    .section-title {
      font-size: 1.5rem;
    }

    .professor-card {
      grid-template-columns: 1fr;
      padding: 2rem;
      gap: 2rem;
    }

    .professor-image {
      max-width: 250px;
      margin: 0 auto;
    }

    .professor-name-row {
      flex-direction: column;
      align-items: flex-start;
      gap: 0.75rem;
    }

    .professor-info h3 {
      font-size: 1.6rem;
    }

    .student-card {
      gap: 1.25rem;
      padding: 1rem 0;
    }

    .student-image {
      width: 100px;
      height: 100px;
    }

    .student-card h3 {
      font-size: 1rem;
    }

    .student-email,
    .student-research-area {
      font-size: 0.75rem;
    }

    .student-badge {
      width: 26px;
      height: 26px;
    }

    .student-badge svg {
      width: 14px;
      height: 14px;
    }
  }
</style>
